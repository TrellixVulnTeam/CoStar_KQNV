-file("test/lib/gs/src/gstk_menubar.erl", 1).

-module(gstk_menubar).

-export([create/3,
         config/3,
         read/3,
         delete/2,
         event/5,
         option/5,
         read_option/5,
         mk_create_opts_for_child/4]).

-file("test/lib/gs/src/gstk.hrl", 1).

-record(gstkid,{id = undefined,widget,widget_data,owner,parent,objtype}).

-record(so,{main,object,hscroll,vscroll,misc}).

-file("test/lib/gs/src/gstk_menubar.erl", 69).

create(DB, GstkId, Opts) ->
    TkW = gstk_generic:mk_tkw_child(DB, GstkId),
    MPreCmd = ["frame ",TkW],
    PlaceCmd = [";place ",TkW],
    Ngstkid = GstkId#gstkid{widget = TkW},
    case
        gstk_generic:make_command(Opts,
                                  Ngstkid,
                                  TkW,
                                  MPreCmd,
                                  PlaceCmd,
                                  DB)
    of
        {error,Reason} ->
            {error,Reason};
        Cmd when is_list(Cmd) ->
            gstk:exec([Cmd,";pack ",TkW," -side top -fill x;"]),
            Ngstkid
    end.

config(DB, Gstkid, Opts) ->
    TkW = Gstkid#gstkid.widget,
    SimplePreCmd = [TkW," conf"],
    PlacePreCmd = ["place ",TkW],
    gstk_generic:mk_cmd_and_exec(Opts,
                                 Gstkid,
                                 TkW,
                                 SimplePreCmd,
                                 PlacePreCmd,
                                 DB).

read(DB, Gstkid, Opt) ->
    gstk_generic:read_option(DB, Gstkid, Opt).

delete(DB, Gstkid) ->
    gstk_db:delete_widget(DB, Gstkid),
    Gstkid#gstkid.widget.

event(DB, Gstkid, Etype, Edata, Args) ->
    gstk_generic:event(DB, Gstkid, Etype, Edata, Args).

mk_create_opts_for_child(DB, Cgstkid, Pgstkid, Opts)
    when Cgstkid#gstkid.objtype == menubutton ->
    case gstk_db:lookup_def(Pgstkid, menubutton, bg) of
        false ->
            MbarTkW = Pgstkid#gstkid.widget,
            Color = tcl2erl:ret_color([MbarTkW," cg -bg"]),
            gstk_db:insert_def(Pgstkid, menubutton, {bg,Color});
        _ ->
            done
    end,
    gstk_generic:mk_create_opts_for_child(DB, Cgstkid, Pgstkid, Opts).

option(Option, _Gstkid, _TkW, _DB, _) ->
    case Option of
        {bg,Color} ->
            {s,[" -bg ",gstk:to_color(Color)]};
        {height,Height} ->
            {s,[" -height ",gstk:to_ascii(Height)]};
        _ ->
            invalid_option
    end.

read_option(Option, GstkId, TkW, _DB, _) ->
    case Option of
        bg ->
            tcl2erl:ret_color([TkW," cg -bg"]);
        height ->
            tcl2erl:ret_int(["update idletasks;winfo he ",TkW]);
        _ ->
            {bad_result,{GstkId#gstkid.objtype,invalid_option,Option}}
    end.



