-file("test/lib/inets/examples/httpd_load_test/hdlt_random_html.erl", 1).

-module(hdlt_random_html).

-export([page/3]).

page(SessionID, _Env, Input) ->
    [WorkSimStr,SzSimStr] = string:tokens(Input, [$:]),
    WorkSim = list_to_integer(WorkSimStr),
    SzSim = list_to_integer(SzSimStr),
    mod_esi:deliver(SessionID, "Content-Type:text/html\r\n\r\n"),
    mod_esi:deliver(SessionID, start("Random test page")),
    mod_esi:deliver(SessionID, content(WorkSim, SzSim)),
    mod_esi:deliver(SessionID, stop()),
    ok.

start(Title) ->
    "<HTML>  \n<HEAD>  \n<TITLE>"
    ++
    Title ++ "</TITLE> \n </HEAD>  \n<BODY>\n".

stop() ->
    "</BODY>  \n</HTML>\n".

content(WorkSim, SzSim) ->
    {A,B,C} = now(),
    random:seed(A, B, C),
    lists:sort([ 
                random:uniform(X) ||
                    X <- lists:seq(1, WorkSim)
               ]),
    lists:flatten(lists:duplicate(SzSim, "Dummy data ")).



