-file("test/lib/diameter/test/diameter_ct.erl", 1).

-module(diameter_ct).

-export([run/1,cover/0]).

run(Suites) ->
    ct_run([{suite,Suites}]).

cover() ->
    ct_run([{spec,"./testspec"}]).

ct_run(Opts) ->
    Start = info(),
    ct:run_test([{logdir,"./log"},{auto_compile,false}|Opts]),
    info(Start, info()).

info() ->
    [{time,now()},
     {process_count,erlang:system_info(process_count)}|
     erlang:memory()].

info(L0, L1) ->
    [T,C|M] =
        lists:zipwith(fun({T,N0}, {T,N1}) ->
                             {T,N1,diff(T, N0, N1)}
                      end,
                      L0,
                      L1),
    Diff = [T,C,{memory,M}],
    io:format("INFO: ~p~n", [Diff]).

diff(time, T0, T1) ->
    timer:now_diff(T1, T0);
diff(_, N0, N1) ->
    N1 - N0.



